##xic_all = [];
##dwc_all = [];
##
##for ii = 1:NP
##  %ii
##  idxnbr =  neighbors_shock(ii,:);
##  pc = pnts(:, idxnbr);
##  wc = w(idxnbr)';
##  [xic, dwc] = derCurve(pc, wc, shape1);
##  xic_all = [xic_all; xic(nl+1,:)];
##  dwc_all = [dwc_all; dwc(nl+1)];
##endfor

%%

y0 = [pnts(1,:)'; pnts(2,:)'; nn(1,:)'; nn(2,:)'];

[dy, xic_all, dwc_all] = dydt(0, y0, c, neighbors_shock, shape1, nl, true, corners);

%%

figure(2); hold on;
plot(pnts(1,:), pnts(2,:), 'ko');
quiver(pnts(1,:),pnts(2,:),dy(2*NP+1 : 3*NP),dy(3*NP+1 : 4*NP), 'r');
%quiver(pnts(1,:),pnts(2,:),-xic_all(:,1).*dwc_all,-xic_all(:,2).*dwc_all, 'b');
%quiver(pnts(1,:),pnts(2,:), -nn(2,:), nn(1,:), 'r')
axis equal; axis tight; grid on;

figure(1); hold on;
xidir = xic_all(:,1).*tn(1,:)' + xic_all(:,2).*tn(2,:)';
plot(dwc_all.*xidir, 'r+-');
grid on;

dw_analytic = [0.
0.011960501260013709
0.022478399542123058
0.030285086403477206
0.03443895834655192
0.03443898896563473
0.030285163933140496
0.022478487706281046
0.01196055880466181
3.105982168072919e-13
-0.011960558804351212
-0.02247848770659164
-0.030285163933140496
-0.03443898896594533
-0.03443895834670722
-0.030285086403321906
-0.022478399542278357
-0.011960501260052533
-3.634199215245627e-15
0.011960501259936059
0.022478399542200708
0.030285086403632505
0.03443895834655192
0.03443898896563473
0.030285163933451095
0.022478487706281046
0.011960558805283007
0.
-0.011960558805283007
-0.022478487705970447
-0.030285163932829897
-0.03443898896594533
-0.034438958347017816
-0.030285086403787805
-0.022478399542045408
-0.011960501259936059
2.1344772736357475e-15
0.011960501260052533
0.022478399542356007
0.030285086403477206
0.03443895834670722
0.03443898896563473
0.030285163933140496
0.02247848770690224
0.01196055880466181
0.
-0.011960558804351212
-0.02247848770659164
-0.030285163933140496
-0.03443898896563473
-0.03443895834670722
-0.030285086403632505
-0.022478399542123058
-0.011960501260013709
4.846673215065654e-15
0.011960501260052533
0.022478399542045408
0.030285086403632505
0.03443895834670722
0.03443898896610063
0.030285163932829897
0.02247848770659164
0.011960558805593605
0.
-0.01196055880497241
-0.022478487706281046
-0.0302851639325193
-0.03443898896594533
-0.03443895834670722
-0.030285086403787805
-0.02247839954196776
-0.011960501260013709];

plot(dw_analytic, 'ko-');





